name: build
on: push

jobs:
  buildJob:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Install
        run:
          pip install -r requirement.txt

      - name: Build
        run: 
          mkdocs build

      - name: Deploy to Server 
        uses: AEnterprise/rsync-deploy@v1.0
        env:
          DEPLOY_KEY: ${{ secrets.VPSSSHKEY }}
          ARGS: -avz --delete --exclude='*.pyc'
          SERVER_PORT: ${{ secrets.VPSPORT }} # SSH端口
          FOLDER: ./site/* # 要推送的文件夹，路径相对于代码仓库的根目录
          SERVER_IP: ${{ secrets.VPSHOST }} # 引用配置，服务器的host名（IP或者域名domain.com）
          USERNAME: ${{ secrets.USERNAME }}
          SERVER_DESTINATION: ${{ secrets.VPSPATH }} # 部署到目标文件夹

      - name: Reload
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPSHOST }}
          username: ${{ secrets.USERNAME}}
          password: ${{secrets.VPSPW }}
          port: ${{ secrets.VPSPORT }}
          script: |
            nginx -s reload